<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.1/css/bulma.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    <!-- <link rel="stylesheet" href="style.css"> -->
    <title>Welcome to Nutreent!</title>
</head>

<body>
    <!-- logo for NuTreent -->
    <section class="hero is fullheight">
        <div class="hero-body">
            <div class="container">
                <figure class="image">
                    <img src="NuTreentNarrow.png">
                </figure>
            </div>

        </div>
        </div>
    </section>
    <!-- insert input section -->
    <div class="mx-6">
        <div class="control has-icons-left">
            <input class="input is-large" id="recipe" type="search" placeholder="What would you like to eat today?">
            <span class="icon is-medium is-left">
                <i class="fas fa-search"></i>
            </span>
            <label class="label">Number of Results</label>
            <div class="control">
                <input class="input" id="numResults" type="text" placeholder="Default 10">
            </div>
        </div>
    </div>

    <!-- insert drop down menu bar for special diet plans -->
    <div class="mx-6">
        <div class="field">
            <label class="label">Dietary Plans</label>
            <p class="control">
                <span class="select">
                    <select id="diet">
                        <option>None</option>
                        <option>Vegetarian</option>
                        <option>Vegan</option>
                        <option>Pescetarian</option>
                        <option>Ketogenic</option>
                        <option>Paleo</option>
                        <option>Gluten Free</option>
                    </select>
                </span>
            </p>
        </div>

        <!-- insert drop down menu bar for meal time -->
        <div class="field">
            <label class="label">Sort By (Descending)</label>
            <p class="control">
                <span class="select">
                    <select id="sortBy">
                        <option>Healthiness</option>
                        <option>Calories</option>
                        <option>Popularity</option>
                        <option>Time</option>
                        <option>Price</option>
                        <option>Random</option>
                    </select>
                </span>
            </p>
        </div>
    </div>

    <div class="field is-grouped mx-6 mt-6">
        <div class="control">
            <button class="button is-link" id="searchBtn">Display Recipes</button>
        </div>
    </div>
    
    <!-- recipes are stored here -->
    <div class="section mx-6" id="results"></div>

    <footer class="footer">
        <div class="content has-text-centered">
            <p>
            <h6>Â©NuTreent 2020</h6>
            </p>
        </div>
    </footer>

    <!-- javascript -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    <script>

        $(document).ready(function () {

            // event listener for submit button
            $("#searchBtn").on("click", function (event) {
                event.preventDefault();

                // variables to store user input
                var recipeSearch = $("#recipe").val();
                var numResults = $("#numResults").val();
                var key = 'ea5ee7462a104b1f97d63a7f03d3330f';
                var dietary = $("#diet").val();
                var sorting = $("#sortBy").val();
                // URL for recipes
                var queryUrl = `https://api.spoonacular.com/recipes/complexSearch?apiKey=${key}&query=${recipeSearch}&number=${numResults}&diet=${dietary}&sort=${sorting}&sortDirection=desc`;
                var queryUrlNoDiet = `https://api.spoonacular.com/recipes/complexSearch?apiKey=${key}&query=${recipeSearch}&number=${numResults}&sort=${sorting}&sortDirection=desc`;
                // clear user input
                $("#recipe").val('');
                $("#numResults").val('');

                // call function to return list of recipes
                if (dietary === 'None') {
                    getRecipes(queryUrlNoDiet, numResults);
                } else {
                    getRecipes(queryUrl, numResults);
                }

            })

            // function to return list of recipes
            function getRecipes(queryUrl, numResults) {
                // ajax call to get recipes
                $.ajax({
                    url: queryUrl,
                    method: "GET"
                }).then(function (response) {
                    console.log(response);

                    for (var i = 0; i < parseInt(numResults); i++) {
                        // create new box and article
                        var newBox = $("<div>", { "class": "box" });
                        newBox.attr("data-recipeId", response.results[i].id);
                        var newArticle = $("<article>", { "class": "media" });

                        // create tags to hold image for each box
                        var imgDiv = $("<div>", { "class": "media-left" });
                        var newFig = $("<figure>", { "class": "image is-128x128" });
                        var newImg = $("<img>", {
                            src: response.results[i].image,
                            alt: response.results[i].title,
                        });

                        newFig.append(newImg);
                        imgDiv.append(newFig);

                        var newPara = $("<p>", { text: response.results[i].title });

                        newArticle.append(imgDiv, newPara);
                        newBox.append(newArticle);
                        $("#results").append(newBox);

                    }
                })
            }

            $("#results").on("click", ".box", function (event) {

                event.preventDefault();

                // save clicked item recipeId to local storage
                var recipeId = $(this).attr("data-recipeId");
                localStorage.setItem("recipeId", recipeId);

                // redirect to next displayNutrients page
                window.location = "displayNutrients.html";

            })

        });
    </script>
</body>

</html>